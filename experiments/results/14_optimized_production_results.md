# 14_optimized_production

_Production-optimized config: MLX + Length-Aware Batching_

**Timestamp:** 2025-12-26 02:26:23

**Model:** `cross-encoder/ms-marco-MiniLM-L-6-v2`

**Backend:** `mlx` | **Device:** `mps`

**Dynamic Batching:** enabled (max_batch=256, timeout=200ms)

## Results Summary

| Batch | Conc | Pairs | Time(s) | Lat Avg | Lat P95 | Lat P99 | TP Avg | TP P95 |
|-------|------|-------|---------|---------|---------|---------|--------|--------|
| 32 | 1 | 3200 | 28.09 | 280.9ms | 299.5ms | 387.0ms | 113.9 | 123.3 |

## Detailed Metrics

### Config 1: batch=32, concurrency=1

**Total:** 3200 pairs in 28.09s

#### Latency (ms)
| Metric | Value |
|--------|-------|
| Average | 280.93 |
| Min | 256.93 |
| Max | 399.45 |
| Std Dev | 23.99 |
| P50 | 280.34 |
| P90 | 294.52 |
| P95 | 299.50 |
| P99 | 387.03 |

#### Throughput (pairs/s)
| Metric | Value |
|--------|-------|
| Average | 113.90 |
| Min | 80.11 |
| Max | 124.55 |
| Std Dev | 8.08 |
| P50 | 114.15 |
| P90 | 122.15 |
| P95 | 123.29 |
| P99 | 124.48 |

#### Latency vs Throughput Analysis

| Latency Range | Avg Throughput | Min Throughput | Max Throughput | Count |
|---------------|----------------|----------------|----------------|-------|
| < 280.3ms (P50) | 120.46 | 114.78 | 124.55 | 50 |
| 280.3-288.3ms (P50-P75) | 112.24 | 111.01 | 113.53 | 25 |
| 288.3-294.5ms (P75-P90) | 109.95 | 108.69 | 110.93 | 15 |
| >= 294.5ms (P90+) | 98.06 | 80.11 | 108.26 | 10 |

**Correlation:** -0.988 (negative correlation expected: lower latency = higher throughput)

## Overall Summary

| Metric | Value | Config |
|--------|-------|--------|
| Best Throughput | 113.90 p/s | batch=32, conc=1 |
| Best Latency | 280.93ms | batch=32, conc=1 |
| Avg Throughput | 113.90 p/s | all configs |
| Avg Latency | 280.93ms | all configs |

## Dashboard Metrics Summary

| Metric | Avg | Min | Max | P50 | P95 |
|--------|-----|-----|-----|-----|-----|
| GPU Memory (MB) | 1182.1 | 1087.6 | 1263.6 | 1177.6 | 1237.6 |
| GPU Utilization (%) | 22.5 | 11.0 | 33.3 | 22.1 | 29.7 |
| CPU Usage (%) | 70.3 | 13.8 | 85.6 | 71.5 | 84.5 |
| Tokenization (ms) | 15.7 | 10.1 | 90.7 | 11.6 | 46.2 |
| Inference (ms) | 68.1 | 46.9 | 121.0 | 70.8 | 85.3 |
| Queue Wait (ms) | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 |
| Padding Waste (%) | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 |

## Dashboard Time-Series Data

| Index | GPU Mem (MB) | GPU Util (%) | CPU (%) | Latency (ms) | Throughput | Tokenize (ms) | Inference (ms) | Queue (ms) | Padding (%) |
|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| 0 | 1087.6 | 11.0 | 33.2 | 179.5 | 32 | 15.9 | 109.5 | 0.0 | 0.0 |
| 1 | 1087.6 | 21.2 | 74.4 | 235.0 | 96 | 11.3 | 53.0 | 0.0 | 0.0 |
| 2 | 1087.6 | 21.0 | 72.7 | 264.1 | 128 | 11.9 | 53.9 | 0.0 | 0.0 |
| 3 | 1087.6 | 16.1 | 68.5 | 265.3 | 96 | 10.9 | 75.2 | 0.0 | 0.0 |
| 4 | 1137.6 | 20.2 | 79.8 | 278.2 | 96 | 11.5 | 72.4 | 0.0 | 0.0 |
| 5 | 1137.6 | 21.2 | 81.3 | 282.1 | 96 | 11.0 | 66.5 | 0.0 | 0.0 |
| 6 | 1137.6 | 28.4 | 64.4 | 282.7 | 128 | 10.9 | 72.7 | 0.0 | 0.0 |
| 7 | 1165.6 | 21.5 | 61.4 | 283.4 | 96 | 11.8 | 70.8 | 0.0 | 0.0 |
| 8 | 1165.6 | 22.9 | 80.0 | 287.9 | 96 | 11.8 | 75.7 | 0.0 | 0.0 |
| 9 | 1165.6 | 19.9 | 81.0 | 278.1 | 96 | 11.3 | 72.9 | 0.0 | 0.0 |
| 10 | 1165.6 | 28.0 | 62.1 | 281.4 | 128 | 10.7 | 80.9 | 0.0 | 0.0 |
| 11 | 1195.6 | 31.2 | 60.2 | 289.4 | 128 | 11.0 | 77.1 | 0.0 | 0.0 |
| 12 | 1195.6 | 20.2 | 78.1 | 279.0 | 96 | 11.5 | 46.9 | 0.0 | 0.0 |
| 13 | 1195.6 | 16.6 | 82.5 | 266.7 | 96 | 10.4 | 71.8 | 0.0 | 0.0 |
| 14 | 1195.6 | 19.7 | 84.7 | 277.4 | 96 | 11.4 | 50.8 | 0.0 | 0.0 |
| 15 | 1195.6 | 23.0 | 72.0 | 269.3 | 128 | 10.8 | 51.8 | 0.0 | 0.0 |
| 16 | 1195.6 | 22.0 | 70.8 | 266.5 | 128 | 11.5 | 70.7 | 0.0 | 0.0 |
| 17 | 1195.6 | 23.6 | 69.3 | 270.4 | 128 | 11.1 | 49.0 | 0.0 | 0.0 |
| 18 | 1227.6 | 19.9 | 70.8 | 277.8 | 96 | 12.2 | 78.5 | 0.0 | 0.0 |
| 19 | 1263.6 | 23.6 | 78.7 | 291.2 | 96 | 12.9 | 84.6 | 0.0 | 0.0 |
| 20 | 1263.6 | 27.7 | 69.5 | 281.4 | 128 | 11.5 | 53.5 | 0.0 | 0.0 |
| 21 | 1233.6 | 22.8 | 71.4 | 268.6 | 128 | 12.2 | 55.6 | 0.0 | 0.0 |
| 22 | 1233.6 | 23.3 | 68.8 | 269.5 | 128 | 10.9 | 51.9 | 0.0 | 0.0 |
| 23 | 1233.6 | 17.8 | 71.5 | 270.5 | 96 | 11.3 | 53.7 | 0.0 | 0.0 |
| 24 | 1233.6 | 17.9 | 83.8 | 271.3 | 96 | 12.1 | 50.5 | 0.0 | 0.0 |
| 25 | 1233.6 | 25.3 | 81.2 | 275.0 | 128 | 11.8 | 72.3 | 0.0 | 0.0 |
| 26 | 1233.6 | 26.8 | 65.1 | 279.1 | 128 | 12.4 | 68.5 | 0.0 | 0.0 |
| 27 | 1233.6 | 21.7 | 56.0 | 284.1 | 96 | 11.7 | 75.8 | 0.0 | 0.0 |
| 28 | 1233.6 | 23.2 | 63.9 | 294.1 | 96 | 90.7 | 79.5 | 0.0 | 0.0 |
| 29 | 1197.6 | 23.6 | 62.0 | 327.1 | 96 | 90.7 | 79.5 | 0.0 | 0.0 |
| 30 | 1197.6 | 32.6 | 52.3 | 352.2 | 96 | 10.6 | 79.2 | 0.0 | 0.0 |
| 31 | 1197.6 | 29.6 | 36.6 | 314.2 | 96 | 61.8 | 121.0 | 0.0 | 0.0 |
| 32 | 1237.6 | 22.1 | 85.5 | 310.7 | 96 | 12.8 | 83.5 | 0.0 | 0.0 |
| 33 | 1237.6 | 33.3 | 77.4 | 311.4 | 128 | 11.7 | 77.4 | 0.0 | 0.0 |
| 34 | 1237.6 | 29.3 | 66.1 | 285.8 | 128 | 13.0 | 77.4 | 0.0 | 0.0 |
| 35 | 1237.6 | 20.8 | 66.1 | 281.3 | 96 | 10.8 | 75.5 | 0.0 | 0.0 |
| 36 | 1237.6 | 18.5 | 80.3 | 273.4 | 96 | 12.2 | 53.0 | 0.0 | 0.0 |
| 37 | 1205.6 | 17.8 | 85.6 | 271.3 | 96 | 11.3 | 51.9 | 0.0 | 0.0 |
| 38 | 1205.6 | 25.6 | 67.4 | 276.1 | 128 | 12.2 | 77.7 | 0.0 | 0.0 |
| 39 | 1177.6 | 25.6 | 68.2 | 276.2 | 128 | 12.1 | 70.4 | 0.0 | 0.0 |
| 40 | 1177.6 | 25.9 | 66.3 | 276.9 | 128 | 11.6 | 86.4 | 0.0 | 0.0 |
| 41 | 1177.6 | 18.6 | 75.4 | 273.9 | 96 | 11.5 | 51.7 | 0.0 | 0.0 |
| 42 | 1177.6 | 18.3 | 84.5 | 272.4 | 96 | 13.1 | 78.5 | 0.0 | 0.0 |
| 43 | 1177.6 | 26.6 | 83.1 | 277.9 | 128 | 11.1 | 56.0 | 0.0 | 0.0 |
| 44 | 1151.6 | 25.5 | 68.8 | 275.6 | 128 | 11.6 | 55.6 | 0.0 | 0.0 |
| 45 | 1151.6 | 21.3 | 74.4 | 265.0 | 128 | 10.1 | 48.6 | 0.0 | 0.0 |
| 46 | 1151.6 | 20.8 | 70.1 | 263.2 | 128 | 11.5 | 69.9 | 0.0 | 0.0 |
| 47 | 1151.6 | 16.7 | 69.9 | 267.3 | 96 | 11.7 | 52.6 | 0.0 | 0.0 |
| 48 | 1151.6 | 16.5 | 80.8 | 267.1 | 96 | 11.6 | 57.2 | 0.0 | 0.0 |
| 49 | 1151.6 | 19.7 | 78.4 | 278.4 | 96 | 13.8 | 85.2 | 0.0 | 0.0 |
| 50 | 1151.6 | 23.9 | 73.4 | 272.1 | 128 | 10.4 | 52.0 | 0.0 | 0.0 |
| 51 | 1151.6 | 24.8 | 61.7 | 273.9 | 128 | 12.2 | 70.8 | 0.0 | 0.0 |
| 52 | 1151.6 | 25.2 | 74.0 | 275.0 | 128 | 10.6 | 53.3 | 0.0 | 0.0 |
| 53 | 1151.6 | 15.4 | 71.8 | 262.7 | 96 | 11.4 | 50.6 | 0.0 | 0.0 |
| 54 | 1151.6 | 18.3 | 80.3 | 272.6 | 96 | 11.0 | 76.4 | 0.0 | 0.0 |
| 55 | 1151.6 | 18.6 | 83.8 | 273.4 | 96 | 12.7 | 76.0 | 0.0 | 0.0 |
| 56 | 1151.6 | 24.3 | 80.1 | 272.6 | 128 | 11.8 | 57.2 | 0.0 | 0.0 |
| 57 | 1151.6 | 24.4 | 57.2 | 282.0 | 128 | 45.4 | 53.0 | 0.0 | 0.0 |
| 58 | 1151.6 | 19.4 | 66.0 | 288.5 | 96 | 12.0 | 82.7 | 0.0 | 0.0 |
| 59 | 1151.6 | 27.3 | 13.8 | 289.5 | 128 | 12.8 | 78.8 | 0.0 | 0.0 |
