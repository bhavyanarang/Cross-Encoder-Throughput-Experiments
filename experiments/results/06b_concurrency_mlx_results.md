# 06b_concurrency_mlx

_Sweep concurrency levels on MLX backend_

**Timestamp:** 2025-12-26 02:20:17

**Model:** `cross-encoder/ms-marco-MiniLM-L-6-v2`

**Backend:** `mlx` | **Device:** `mps`

## Results Summary

| Batch | Conc | Pairs | Time(s) | Lat Avg | Lat P95 | Lat P99 | TP Avg | TP P95 |
|-------|------|-------|---------|---------|---------|---------|--------|--------|
| 96 | 1 | 9600 | 14.49 | 144.8ms | 232.6ms | 288.3ms | 662.7 | 861.5 |

## Detailed Metrics

### Config 1: batch=96, concurrency=1

**Total:** 9600 pairs in 14.49s

#### Latency (ms)
| Metric | Value |
|--------|-------|
| Average | 144.83 |
| Min | 107.58 |
| Max | 295.83 |
| Std Dev | 38.35 |
| P50 | 135.52 |
| P90 | 198.10 |
| P95 | 232.55 |
| P99 | 288.27 |

#### Throughput (pairs/s)
| Metric | Value |
|--------|-------|
| Average | 662.70 |
| Min | 324.51 |
| Max | 892.33 |
| Std Dev | 131.61 |
| P50 | 708.38 |
| P90 | 848.00 |
| P95 | 861.54 |
| P99 | 884.16 |

#### Latency vs Throughput Analysis

| Latency Range | Avg Throughput | Min Throughput | Max Throughput | Count |
|---------------|----------------|----------------|----------------|-------|
| < 135.5ms (P50) | 794.74 | 711.29 | 892.33 | 50 |
| 135.5-152.0ms (P50-P75) | 682.39 | 633.53 | 705.47 | 25 |
| 152.0-198.1ms (P75-P90) | 588.07 | 485.48 | 626.58 | 15 |
| >= 198.1ms (P90+) | 400.33 | 324.51 | 476.76 | 10 |

**Correlation:** -0.957 (negative correlation expected: lower latency = higher throughput)

## Overall Summary

| Metric | Value | Config |
|--------|-------|--------|
| Best Throughput | 662.70 p/s | batch=96, conc=1 |
| Best Latency | 144.83ms | batch=96, conc=1 |
| Avg Throughput | 662.70 p/s | all configs |
| Avg Latency | 144.83ms | all configs |

## Dashboard Metrics Summary

| Metric | Avg | Min | Max | P50 | P95 |
|--------|-----|-----|-----|-----|-----|
| GPU Memory (MB) | 2377.5 | 1137.6 | 2627.6 | 2627.6 | 2627.6 |
| GPU Utilization (%) | 68.9 | 49.1 | 83.3 | 70.5 | 80.5 |
| CPU Usage (%) | 0.9 | 0.7 | 1.1 | 0.9 | 1.0 |
| Tokenization (ms) | 47.3 | 31.4 | 121.8 | 33.6 | 92.2 |
| Inference (ms) | 104.7 | 75.1 | 146.4 | 102.4 | 143.0 |
| Queue Wait (ms) | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 |
| Padding Waste (%) | 45.8 | 39.8 | 50.3 | 46.2 | 50.2 |

## Dashboard Time-Series Data

| Index | GPU Mem (MB) | GPU Util (%) | CPU (%) | Latency (ms) | Throughput | Tokenize (ms) | Inference (ms) | Queue (ms) | Padding (%) |
|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| 0 | 1137.6 | 49.2 | 0.7 | 146.2 | 480 | 31.4 | 75.1 | 0.0 | 42.6 |
| 1 | 1379.6 | 73.1 | 0.9 | 137.3 | 672 | 31.6 | 117.2 | 0.0 | 39.8 |
| 2 | 1483.6 | 69.0 | 0.8 | 132.8 | 672 | 33.2 | 124.3 | 0.0 | 50.3 |
| 3 | 2627.6 | 83.3 | 0.9 | 173.4 | 576 | 32.7 | 102.7 | 0.0 | 40.3 |
| 4 | 2627.6 | 68.1 | 0.8 | 147.9 | 576 | 33.3 | 120.8 | 0.0 | 48.1 |
| 5 | 2627.6 | 49.1 | 0.8 | 179.8 | 384 | 73.4 | 146.4 | 0.0 | 46.0 |
| 6 | 2627.6 | 55.5 | 0.7 | 200.4 | 384 | 82.4 | 141.8 | 0.0 | 45.7 |
| 7 | 2627.6 | 79.5 | 0.9 | 180.7 | 576 | 34.2 | 92.2 | 0.0 | 47.7 |
| 8 | 2627.6 | 76.6 | 0.8 | 128.4 | 768 | 32.6 | 85.9 | 0.0 | 46.4 |
| 9 | 2627.6 | 63.1 | 0.9 | 131.8 | 672 | 81.7 | 108.7 | 0.0 | 47.6 |
| 10 | 2507.6 | 76.6 | 0.9 | 119.7 | 864 | 33.9 | 86.0 | 0.0 | 43.1 |
| 11 | 2627.6 | 77.5 | 0.9 | 131.6 | 768 | 31.9 | 91.0 | 0.0 | 45.4 |
| 12 | 2627.6 | 67.6 | 0.8 | 131.8 | 672 | 36.0 | 102.0 | 0.0 | 49.5 |
| 13 | 2627.6 | 72.7 | 0.8 | 126.0 | 768 | 33.8 | 94.4 | 0.0 | 50.2 |
| 14 | 2627.6 | 69.2 | 0.9 | 120.5 | 768 | 32.1 | 80.1 | 0.0 | 41.4 |
| 15 | 2627.6 | 71.8 | 1.1 | 135.2 | 768 | 121.8 | 106.9 | 0.0 | 48.1 |
